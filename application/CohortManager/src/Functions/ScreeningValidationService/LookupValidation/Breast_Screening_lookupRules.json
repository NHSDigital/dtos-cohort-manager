[
  {
    "WorkflowName": "Common",
    "GlobalParams": [
      {
        "Name": "ValidCurrentPosting",
        "Expression": "string.IsNullOrEmpty(newParticipant.CurrentPosting) OR dbLookup.CheckIfCurrentPostingExists(newParticipant.CurrentPosting)"
      },
      {
        "Name": "ValidPrimaryCareProvider",
        "Expression": "string.IsNullOrEmpty(newParticipant.PrimaryCareProvider) || dbLookup.CheckIfPrimaryCareProviderExists(newParticipant.PrimaryCareProvider)"
      }
    ],
    "Rules": [
      {
        "RuleName": "45.GPPracticeCodeDoesNotExist.BSSelect.NonFatal",
        "LocalParams": [
          {
            "Name": "EnglishPostingCategory",
            "Expression": "dbLookup.RetrievePostingCategory(newParticipant.CurrentPosting) == \"ENGLAND\""
          },
          {
            "Name": "InvalidPostingCategory",
            "Expression": "!(EnglishPostingCategory || newParticipant.CurrentPosting == \"ENG\" || newParticipant.CurrentPosting == \"IM\" || newParticipant.CurrentPosting == \"DMS\")"
          },
          {
            "Name": "IsExcluded",
            "Expression": "dbLookup.CheckIfPrimaryCareProviderInExcludedSmuList(newParticipant.PrimaryCareProvider)"
          }
        ],
        "Expression": "(InvalidPostingCategory || ValidPrimaryCareProvider || IsExcluded)",
        "Actions": {
          "OnFailure": {
            "Name": "OutputExpression",
            "Context": {
              "Expression": "\"GP practice code does not exist\""
            }
          }
        }
      }
    ]
  },
  {
    "WorkflowName": "AMENDED",
    "Rules": [
      {
        "RuleName": "54.ValidateBsoCode.Non.NonFatal",
        "LocalParams": [
          {
            "Name": "reasonForRemoval",
            "Expression": "newParticipant.ReasonForRemoval == \"RDI\" OR newParticipant.ReasonForRemoval == \"RDR\" OR newParticipant.ReasonForRemoval == \"RPR\""
          },
          {
            "Name": "postcode",
            "Expression": "string.IsNullOrEmpty(newParticipant.Postcode) OR !dbLookup.ValidateOutcode(newParticipant.Postcode)"
          },
          {
            "Name": "primaryCareProvider",
            "Expression": "(string.IsNullOrEmpty(existingParticipant.PrimaryCareProvider) || !dbLookup.CheckIfPrimaryCareProviderExists(existingParticipant.PrimaryCareProvider)) && (string.IsNullOrEmpty(existingParticipant.PrimaryCareProvider) || !existingParticipant.PrimaryCareProvider.StartsWith(\"ZZZ\"))"
          }
        ],
        "Expression": "!(reasonForRemoval AND postcode AND primaryCareProvider)"
      },
      {
        "RuleName": "17.AddressLinesNullAndPostcodeDoesNotMatchExisting.NBO.NonFatal",
        "LocalParams": [
          {
            "Name": "addressLines",
            "Expression": "string.IsNullOrEmpty(newParticipant.AddressLine1) && string.IsNullOrEmpty(newParticipant.AddressLine1) && string.IsNullOrEmpty(newParticipant.AddressLine3) && string.IsNullOrEmpty(newParticipant.AddressLine4) && string.IsNullOrEmpty(newParticipant.AddressLine5)"
          },
          {
            "Name": "emptyPostcode",
            "Expression": "string.IsNullOrEmpty(newParticipant.Postcode)"
          },
          {
            "Name": "PostcodeDoesNotMatch",
            "Expression": "string.Equals(newParticipant.Postcode, existingParticipant.Postcode, StringComparison.OrdinalIgnoreCase) == false"
          }
        ],
        "Expression": "!((emptyPostcode OR PostcodeDoesNotMatch) AND addressLines)"
      },
      {
        "RuleName": "51.ParticipantLocationRemainingOutsideOfCohort.ParticipantLocationRemainingOutsideOfCohort.NonFatal",
        "LocalParams": [
          {
            "Name": "ExistingParticipantInDMS",
            "Expression": "(!string.IsNullOrEmpty(existingParticipant.CurrentPosting) AND string.Equals(existingParticipant.CurrentPosting, \"DMS\", StringComparison.OrdinalIgnoreCase) AND !string.IsNullOrEmpty(existingParticipant.PrimaryCareProvider) AND dbLookup.CheckIfPrimaryCareProviderInExcludedSmuList(existingParticipant.PrimaryCareProvider))"
          },
          {
            "Name": "existingParticipantPosting",
            "Expression": "ExistingParticipantInDMS OR string.Equals(dbLookup.RetrievePostingCategory(existingParticipant.CurrentPosting), \"WALES\", StringComparison.OrdinalIgnoreCase)"
          },
          {
            "Name": "NewParticipantInDMS",
            "Expression": "(!string.IsNullOrEmpty(newParticipant.CurrentPosting) AND string.Equals(newParticipant.CurrentPosting, \"DMS\", StringComparison.OrdinalIgnoreCase) AND !string.IsNullOrEmpty(newParticipant.PrimaryCareProvider) AND dbLookup.CheckIfPrimaryCareProviderInExcludedSmuList(newParticipant.PrimaryCareProvider))"
          },
          {
            "Name": "newParticipantPosting",
            "Expression": "NewParticipantInDMS OR string.Equals(dbLookup.RetrievePostingCategory(newParticipant.CurrentPosting), \"WALES\", StringComparison.OrdinalIgnoreCase)"
          }
        ],
        "Expression": "!(existingParticipantPosting AND newParticipantPosting)",
        "Actions": {
          "OnSuccess": {
            "Name": "OutputExpression",
            "Context": {
              "Expression": "\"Resident in not included area in cohort moving to same or another area not included in cohort.\""
            }
          }
        }
      }
    ]
  }
]
