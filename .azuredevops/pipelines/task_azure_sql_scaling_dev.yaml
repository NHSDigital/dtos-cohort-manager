---

name: $(Build.SourceBranchName)-$(Date:yyyyMMdd)_$(Rev:r)
trigger: none
pr: none

pool:
  name: private-pool-dev-uks

schedules:
  - cron: "45 4 * * *" # Run at 04:45 AM UTC
    displayName: 'Scale_Peak'
    branches:
      include:
      - main
    always: true

  - cron: "0 17 * * *" # Run at 5:00 PM UTC
    displayName: 'Scale_OffPeak'
    branches:
      include:
      - main
    always: true

resources:
  repositories:
    - repository: dtos-devops-templates
      type: github
      name: NHSDigital/dtos-devops-templates
      ref: 269a046832ad61fcd41dc6179303913f1b015294
      endpoint: NHSDigital

parameters:
  - name: manualOverride
    displayName: Manual Override
    type: string
    default: 'false'
    values:
    - 'false'
    - 'Scale_Peak'
    - 'Scale_OffPeak'
  - name: Sku_Peak
    displayName: Peak SKU
    type: string
    default: 'S2'
  - name: Sku_OffPeak
    displayName: Off-Peak SKU
    type: string
    default: 'S1'

variables:
  - group: DEV_core_backend

stages:
- template: ../templates/task-azure-sql-scaling-common.yaml
  parameters:
    manualOverride: ${{ parameters.manualOverride }}
    Sku_Peak: ${{ parameters.Sku_Peak }}
    Sku_OffPeak:  ${{ parameters.Sku_OffPeak }}
